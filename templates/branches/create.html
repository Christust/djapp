{% extends "index.html" %}
{% block title %} Crear branch {% endblock title %}
{% block body %}
	<form method="POST">
		{% csrf_token %}
		{{ branch_form.as_p }}
		<button type="submit">Crear</button>
	</form>
{% endblock body %}
{% block extrajs %}
<script>
	$(document).ready(function() {
	    $('#id_country').change(function() {
	        var countryId = $(this).val();
	        if (countryId) {
	            $.ajax({
	                url: '/branches/ajax/load_states/',
	                data: {
	                    'country_id': countryId
	                },
	                dataType: 'json',  // Especificar el tipo de datos que se espera
	                success: function(data) {
	                    // Limpiar y actualizar el select de estados
	                    $('#id_state').empty();
	                    $('#id_state').append('<option value="">---------</option>');
	                    $.each(data, function(index, state) {
	                        $('#id_state').append($('<option></option>')
	                            .attr('value', state.id)
	                            .text(state.name));
	                    });

	                    // Limpiar y actualizar el select de ciudades
	                    $('#id_city').empty();
	                    $('#id_city').append('<option value="">---------</option>');
	                }
	            });
	        } else {
	            // Limpiar selectores si no hay pa√≠s seleccionado
	            $('#id_state').empty();
	            $('#id_state').append('<option value="">---------</option>');
	            $('#id_city').empty();
	            $('#id_city').append('<option value="">---------</option>');
	        }
	    });

	    $('#id_state').change(function() {
	        var stateId = $(this).val();
	        if (stateId) {
	            $.ajax({
	                url: '/branches/ajax/load_cities/',
	                data: {
	                    'state_id': stateId
	                },
	                dataType: 'json',  // Especificar el tipo de datos que se espera
	                success: function(data) {
	                    // Limpiar y actualizar el select de ciudades
	                    $('#id_city').empty();
	                    $('#id_city').append('<option value="">---------</option>');
	                    $.each(data, function(index, city) {
	                        $('#id_city').append($('<option></option>')
	                            .attr('value', city.id)
	                            .text(city.name));
	                    });
	                }
	            });
	        } else {
	            // Limpiar select de ciudades si no hay estado seleccionado
	            $('#id_city').empty();
	            $('#id_city').append('<option value="">---------</option>');
	        }
	    });
	});
</script>
{% endblock extrajs %}